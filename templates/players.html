{% extends "layout.html" %}
{% block title %}Jugadores{% endblock %}
{% block content %}

<!-- Month/Year Selector -->
<form method="GET" class="mb-5 flex gap-2 items-center text-xs">
  <label class="text-primary" for="monthSelect">Mes:</label>
  <select id="monthSelect" name="month" class="bg-gray-700 text-primary rounded px-1 py-0.5">
    {% for m in range(1,13) %}
      <option value="{{m}}" {% if m == month %}selected{% endif %}>{{m}}</option>
    {% endfor %}
  </select>

  <label class="text-primary" for="yearInput">Año:</label>
  <input id="yearInput" type="number" name="year" value="{{year}}" class="bg-gray-700 text-primary rounded px-1 py-0.5 w-16"/>

  <button type="submit" class="bg-primary text-dark rounded px-2 py-0.5">Ver</button>
</form>

<!-- Scrollable table -->
<div class="overflow-x-auto w-full">
  <table class="table-auto min-w-full text-xs border-0 margin-top-10">
    <thead class="bg-gray-800">
      <tr>
        <!-- Delete -->
        <th class="sticky left-0 z-20 bg-gray-800 border-r border-gray-800 px-1 py-1" style="min-width:30px;"></th>
        
        <!-- Player Name -->
        <th class="sticky left-8 z-20 text-primary bg-gray-800 border-r border-gray-700 px-1 py-1 text-left" style="min-width:80px;">
          Jugador
        </th>

        <!-- Training dates -->
        {% for date in training_dates %}
          <th class="border-r border-gray-700 px-1 py-1 text-primary text-center" style="min-width:50px;">
            {{ date.strftime('%d %b') }}
          </th>
        {% endfor %}

        <!-- Sticky Total Column -->
        <th class="sticky right-0 z-20 bg-gray-800 border-l text-primary border-black-700 px-1 py-1 text-center" style="min-width:50px;">
          Total
        </th>
      </tr>
    </thead>

    <tbody>
      {% set total_players = players|length %}
      {% for player in players %}
        {% set row_class = "" %}
        {% if total_players > 10 %}
          {% if loop.index > total_players - 5 %}
            {% set row_class = "bg-red-300 text-dark" %} <!-- Bottom 5 -->
          {% elif loop.index > total_players - 7 %}
            {% set row_class = "bg-yellow-300 text-dark" %} <!-- Next 2 -->
          {% elif loop.index == 1 %}
            {% set row_class = "bg-green-300 text-dark" %} <!-- Top player -->
          {% endif %}
        {% endif %}

        <tr class="border-b border-gray-700 {{row_class}}">
          <!-- Delete Player -->
          <td class="sticky left-0 z-10 bg-gray-900 px-1 py-1 text-center text-white border-0" style="min-width:30px;">
            <form method="POST" action="{{url_for('players.delete_player', player_id=player.id)}}" onsubmit="return confirm('¿Borrar este jugador?');">
              <button type="submit" class="text-sm">–</button>
            </form>
          </td>

          <!-- Player Name -->
          <td class="sticky left-8 z-10 bg-gray-900 px-1 py-1 text-left text-white border-r border-gray-700" style="min-width:80px;">
            {{player.name}}
          </td>

          <!-- Points per training -->
          {% for date in training_dates %}
            <td class="px-1 py-1 text-center font-semibold border-r border-gray-700" style="min-width:50px;">
              {{training_points[player.id][date.strftime('%Y-%m-%d')] if date.strftime('%Y-%m-%d') in training_points[player.id] else '-'}}
            </td>
          {% endfor %}

          <!-- Sticky total points column -->
          <td class="sticky right-0 z-10 bg-gray-600 text-primary border-l border-black-700 px-1 py-1 text-center font-bold" style="min-width:50px;">
            {{total_points[player.id]}}
          </td>
        </tr>
      {% endfor %}
    </tbody>

    <!-- Add Player Row -->
    <tfoot>
      <form method="POST" action="{{url_for('players.add_player')}}">
        <tr class="bg-gray-800">
          <td class="sticky left-0 z-10 bg-gray-900 px-1 py-1 text-center border-r border-gray-700" style="min-width:30px;">
            <button type="submit" class="text-sm">+</button>
          </td>
          <td class="sticky left-8 z-10 bg-gray-900 px-1 py-1 border-r border-gray-700" style="min-width:80px;">
            <input type="text" name="name" placeholder="Jugador" required class="bg-gray-700 text-white rounded px-1 py-0.5 w-full"/>
          </td>
          {% for date in training_dates %}
            <td class="px-1 py-1 border-r border-gray-700 text-center">-</td>
          {% endfor %}
          <td class="sticky right-0 z-10 bg-gray-600 text-white border-l border-gray-700 px-1 py-1 text-center">-</td>
        </tr>
      </form>
    </tfoot>
  </table>
</div>


{% endblock %}
